# PWA & i18n Setup Guide

This document explains the PWA (Progressive Web App) and internationalization (i18n) setup for the Advocate application.

## üåç Internationalization (i18n)

### Supported Languages
- **English (en)** - Default language, LTR
- **Arabic (ar)** - RTL support enabled

### Configuration Files

#### 1. `i18n.config.ts`
Defines supported locales, default locale, and text direction for each language.

#### 2. `middleware.ts`
Handles automatic locale detection and routing:
- Detects user's preferred language from browser
- Redirects to locale-prefixed URLs (e.g., `/en/`, `/ar/`)
- Preserves locale across navigation

#### 3. `next-intl.config.ts`
Configures next-intl with message loading and timezone settings.

#### 4. Translation Files
Located in `messages/` folder:
- `en.json` - English translations
- `ar.json` - Arabic translations

### Adding New Translations

1. Add new keys to both `en.json` and `ar.json`:
```json
// messages/en.json
{
  "Home": {
    "title": "Welcome to Advocate"
  },
  "NewSection": {
    "greeting": "Hello"
  }
}

// messages/ar.json
{
  "Home": {
    "title": "ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿ£ÿØŸÅŸàŸÉŸäÿ™"
  },
  "NewSection": {
    "greeting": "ŸÖÿ±ÿ≠ÿ®ÿß"
  }
}
```

2. Use translations in components:
```tsx
import { useTranslations } from 'next-intl';

export default function MyComponent() {
  const t = useTranslations('NewSection');
  return <h1>{t('greeting')}</h1>;
}
```

### Adding New Languages

1. Add locale to `i18n.config.ts`:
```typescript
export const locales = ['en', 'ar', 'fr'] as const; // Add 'fr'
export const localeNames: Record<Locale, string> = {
  en: 'English',
  ar: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
  fr: 'Fran√ßais', // Add French
};
```

2. Create translation file: `messages/fr.json`

3. Rebuild the application

### URL Structure

All routes are prefixed with locale:
- `/en/` - English homepage
- `/ar/` - Arabic homepage
- `/en/cases` - English cases page
- `/ar/cases` - Arabic cases page

### RTL Support

Arabic automatically uses RTL layout via the `dir` attribute in the HTML tag.

## üì± Progressive Web App (PWA)

### Features Enabled

‚úÖ **Installable** - Users can install the app on their device
‚úÖ **Offline Support** - App works without internet connection
‚úÖ **Push Notifications** - Ready for push notification integration
‚úÖ **App-like Experience** - Runs in standalone mode
‚úÖ **Caching Strategies** - Optimized caching for performance

### Configuration Files

#### 1. `next.config.ts`
PWA configuration with caching strategies:
- **CacheFirst**: Fonts, audio, video (long-term cache)
- **StaleWhileRevalidate**: Images, CSS, JS (balance between speed and freshness)
- **NetworkFirst**: API data, dynamic content (prioritize fresh data)

#### 2. `public/manifest.json`
PWA manifest defining:
- App name and description
- Icons (multiple sizes)
- Display mode (standalone)
- Theme colors
- Shortcuts
- Screenshots

### Caching Strategies Explained

1. **CacheFirst**
   - Serves from cache if available
   - Only fetches from network if not cached
   - Best for: Fonts, audio, video

2. **StaleWhileRevalidate**
   - Serves from cache immediately
   - Updates cache in background
   - Best for: Images, CSS, JS

3. **NetworkFirst**
   - Tries network first
   - Falls back to cache if offline
   - Best for: API calls, dynamic data

### Testing PWA

#### Development
PWA is disabled in development mode by default. To test:

1. Build production version:
```bash
npm run build
npm start
```

2. Open Chrome DevTools ‚Üí Application ‚Üí Service Workers
3. Check "Offline" to test offline functionality

#### Production
1. Deploy to HTTPS domain (required for PWA)
2. Open site in Chrome/Edge
3. Look for install prompt in address bar
4. Click "Install" to add to home screen

### PWA Checklist

Before deploying:

- [ ] Generate all required icon sizes (see `public/icons/README.md`)
- [ ] Update `manifest.json` with your domain and app details
- [ ] Test offline functionality
- [ ] Test on mobile devices (iOS and Android)
- [ ] Verify HTTPS is enabled
- [ ] Test install prompt
- [ ] Check Lighthouse PWA score (aim for 90+)

### Icon Requirements

Required icon sizes (place in `public/icons/`):
- 72x72, 96x96, 128x128, 144x144
- 152x152, 192x192, 384x384, 512x512

See `public/icons/README.md` for generation instructions.

### Service Worker

The service worker is automatically generated by next-pwa:
- `sw.js` - Main service worker
- `workbox-*.js` - Workbox runtime files

These files are created during build and should not be edited manually.

### Updating the PWA

When you deploy updates:
1. Service worker automatically detects new version
2. Downloads new assets in background
3. Prompts user to reload (if `skipWaiting: true`)
4. Updates app on next visit

### Debugging

#### Check Service Worker Status
```javascript
// In browser console
navigator.serviceWorker.getRegistrations().then(registrations => {
  console.log('Active service workers:', registrations);
});
```

#### Clear Cache
```javascript
// In browser console
caches.keys().then(names => {
  names.forEach(name => caches.delete(name));
});
```

#### Unregister Service Worker
```javascript
// In browser console
navigator.serviceWorker.getRegistrations().then(registrations => {
  registrations.forEach(registration => registration.unregister());
});
```

## üöÄ Quick Start

### Install Dependencies
```bash
npm install
```

### Run Development Server
```bash
npm run dev
```

Visit:
- http://localhost:3000 (redirects to /en)
- http://localhost:3000/en (English)
- http://localhost:3000/ar (Arabic)

### Build for Production
```bash
npm run build
npm start
```

### Test PWA
1. Build production version
2. Open Chrome DevTools ‚Üí Lighthouse
3. Run PWA audit
4. Fix any issues reported

## üìù Best Practices

### i18n
- Always add translations for both languages
- Use semantic translation keys (e.g., `Home.title` not `page1.text1`)
- Keep translations in sync
- Test RTL layout thoroughly
- Use `useTranslations` hook in client components
- Use `getTranslations` in server components

### PWA
- Test offline functionality regularly
- Keep service worker cache sizes reasonable
- Update manifest.json with real app details
- Generate proper icons before deployment
- Test on real mobile devices
- Monitor cache storage usage
- Use appropriate caching strategies for different content types

## üîß Troubleshooting

### i18n Issues

**Problem**: Translations not showing
- Check if translation key exists in JSON files
- Verify locale is correctly detected
- Check browser console for errors

**Problem**: Wrong language detected
- Clear browser cache
- Check Accept-Language header
- Manually navigate to /en or /ar

### PWA Issues

**Problem**: Service worker not registering
- Ensure HTTPS is enabled (or localhost)
- Check browser console for errors
- Verify manifest.json is valid

**Problem**: App not installable
- Check PWA requirements in Lighthouse
- Verify manifest.json has all required fields
- Ensure icons are present
- Check HTTPS is enabled

**Problem**: Offline mode not working
- Check service worker is active
- Verify caching strategies are correct
- Test with Chrome DevTools offline mode

## üìö Resources

- [next-intl Documentation](https://next-intl-docs.vercel.app/)
- [next-pwa Documentation](https://github.com/shadowwalker/next-pwa)
- [PWA Best Practices](https://web.dev/pwa/)
- [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)
- [Service Workers](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
